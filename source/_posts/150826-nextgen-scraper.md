title: 写个好的垂直爬虫！
date: 2015-08-26 17:21:19
categories: 工程师思维
tags:
- 爬虫
- Web开发
---
#### 简单来说

爬虫不是虫子，是用来干你站的，也不全是干你站，只是利用你站里的数据做点有用的事，如果你是新闻或者博客站点，那你遇到好爬虫就幸运了，会增加流量的，某歌和某度就是爬虫之上建立起来的公司，所以他们这方面研究比较透彻，这里随便记录几笔吧，做爬虫的人太多了。

爬虫简单写写就两部分，下载，解析。这是一个爬虫抓取环的最基本要素。你可以把两个步骤串起来，也可以并起来，因为两个步骤不冲突。可是做大了就比较复杂了，俩步骤有好多坑要填，

* 下载要填如下坑：地址嗅探、存储、去重、认证、代理、网络io、并行。
* 解析要填如下坑：ajax渲染、格式校正、匹配、抽取、存储、并行。

而垂直爬虫，通俗一点，就是专干一个站的爬虫，干光为止，这样资源基本没有浪费，且能做相当多的优化工作（注意适可而止）。通用爬虫就是，不光干一个站，能干的站尽量干，通用爬虫需要勇气，也需要通用的排序、索引算法做支撑。

#### 我们的目标是

##### 1. 填坑
据说做爬虫的上辈子都是吃了虫子的贝爷。爬虫有三宝，PhantomJS、proxy、黑客好。

##### 2. 爬全与爬准

坑填完了就完了么，并没有，拿垂直爬虫来说，通用爬虫也有这个问题，但是不如垂直爬虫敏感，那就是内容缺失。你没获取到内容你不知道是下载的问题还是解析的问题，所以前面每个坑都得做相应的智能检测，每天的目标站总量内容数据增长，都是有稳定的一个量，至少是线性平滑的，对于大站的突增也一般有新闻能提醒你，小站不可能，除非爆站（爆了小站只能根据内容做垃圾分类了，尤其关键词经过SEO的，内容上过滤的话工作就多了）。所以你知道得监控有效爬取量了。

两种目标站，论坛型和搜索型，有时候同时出现，那就比较幸运了。论坛型比较简单，遍历论坛列表，找特定url就行，如果论坛列表多并且你有需求就像男人一样搞通用爬虫吧！搜索型，需要注意的就是时效性，有些内容是你现在不爬，一辈子都爬不到的，除非关键词覆盖到，而有些内容，可能你一辈子抓都是那些，就是因为关键词组合定位不准。所以非技术因素上，关键词挺重要，或许技术上加一层关键词有效爬取量监控会好很多。另外如何提升时效性，就是为url更新做优化，加时效权值，更新速度快的权值大，内容多的权值大，优先爬取还没做的，和时效权值大的。

##### 3. 省资源与大规模

爬全和爬准要取一个交集，毕竟大规模爬虫的建设，要省。规模化有几个方向：

* 集群化，下载集群，解析集群，存储集群，调度集群
* 优化下载，proxy分布到离目标站近的线路上
* 优化解析，从HTML抽取库改为正则
* 优化调度，内容更新快的多爬快爬，内容更新慢的少爬慢爬

#### 相关工作

搞了10几个站，尽管都是常用技术了，仍然每次做都有新的体会，慢慢梳理。

工程就是艺术。
